{% extends 'employe/base.html' %}
{% block content %}
<div class="p-6" style="background:#ecfdf5;">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold" style="color:#065f46;">Départements</h1>
    {% if request.user.is_authenticated %}
      {% if request.user.is_staff or request.user.is_superuser %}
        <a href="{% url 'ajouter_departement' %}" class="px-4 py-2 rounded text-white" style="background:#10b981;">Ajouter</a>
      {% endif %}
    {% endif %}
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="mb-2 p-2 rounded" style="background:#d1fae5;color:#065f46;">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    {% for d in departements %}
      <div class="p-4 rounded bg-white border" style="border-color:#d1fae5;">
        <div class="flex items-start justify-between">
          <div>
            <h2 class="text-lg font-semibold" style="color:#065f46;">{{ d.name }}</h2>
            <p class="text-sm mt-1">{{ d.description|default:'-' }}</p>
          </div>
          <div class="px-3 py-1 rounded text-sm" style="background:#ecfdf5;color:#065f46;">{{ d.employee_count }} employé(s)</div>
        </div>
          {% if request.user.is_authenticated %}
            {% if request.user.is_staff or request.user.is_superuser %}
            <div class="mt-4">
              <a href="{% url 'modifier_departement' d.id %}" class="px-3 py-1 rounded text-white" style="background:#059669;">Modifier</a>
              <button type="button" onclick="document.getElementById('delete-dept-{{ d.id }}').showModal()" class="ml-2 px-3 py-1 rounded text-white" style="background:#dc2626;">Supprimer</button>
            </div>
            {% endif %}
          {% endif %}
      </div>
        <!-- Delete Modal -->
        <dialog id="delete-dept-{{ d.id }}" class="modal">
          <div class="modal-box">
            <h3 class="font-bold text-lg" style="color:#065f46;">Supprimer le département</h3>
            <p class="py-4">Voulez-vous vraiment supprimer "{{ d.name }}" ?</p>
            <div class="modal-action">
              <form method="dialog">
                <button class="btn">Annuler</button>
              </form>
              <form method="post" action="{% url 'supprimer_departement' d.id %}">
                {% csrf_token %}
                <button class="btn" style="background:#dc2626;color:white;">Supprimer</button>
              </form>
            </div>
          </div>
          <form method="dialog" class="modal-backdrop">
            <button>close</button>
          </form>
        </dialog>
    {% empty %}
      <div class="p-4 rounded bg-white">Aucun département.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}

